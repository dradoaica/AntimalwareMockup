using DRadoaica.Antimalware.SDK;
using log4net.Config;
using System;
using System.Runtime.InteropServices;

namespace DRadoaica.Antimalware.Console
{
    class Program
    {
        [DllImport("kernel32.dll")]
        static extern bool SetConsoleTitle(string lpConsoleTitle);

        [DllImport("kernel32")]
        static extern bool AllocConsole();

        static void Main(string[] args)
        {
            AllocConsole();
            SetConsoleTitle("DRadoaica Antimalware Console");

            XmlConfigurator.Configure();

            AntimalwareHost host = new AntimalwareHostBuilder().UseRESTApi()
                .UseSignalR()
                .Build();

            string read;
            do
            {
                System.Console.WriteLine("Type quit (or q) and press enter to exit");
                read = System.Console.ReadLine();
            } while (!"quit".Equals(read, StringComparison.InvariantCultureIgnoreCase) &&
                    !"q".Equals(read, StringComparison.InvariantCultureIgnoreCase));

            host.RESTApiHost.Dispose();
            host.SignalRHost.Dispose();
        }
    }
}
